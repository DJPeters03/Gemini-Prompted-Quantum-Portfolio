<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Function Collapse</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h1 { font-weight: 300; letter-spacing: 2px; margin-bottom: 10px; }

        canvas {
            background-color: #000000;
            border: 1px solid #333;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.05);
            border-radius: 8px;
            cursor: crosshair;
        }

        #ui-container {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #btn-measure {
            background-color: #ff0055;
            color: white;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
        }

        #btn-measure:hover { background-color: #ff3377; transform: scale(1.05); }
        #btn-measure:active { transform: scale(0.95); }
        #btn-measure:disabled { background-color: #555; cursor: not-allowed; box-shadow: none; }

        #btn-reset {
            background-color: #00ccff;
            color: #000;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.4);
        }
        #btn-reset:hover { background-color: #66e0ff; transform: scale(1.05); }

        .status {
            font-family: monospace;
            color: #888;
            margin-top: 10px;
            height: 20px;
        }
    </style>
</head>
<body>

    <h1>Wave Function Collapse</h1>
    
    <canvas id="simCanvas" width="800" height="400"></canvas>
    
    <div id="statusText" class="status">State: Superposition (Moving)</div>

    <div id="ui-container">
        <button id="btn-measure" onclick="measure()">Measure Position</button>
        <button id="btn-reset" onclick="resetSim()">Reset System</button>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('statusText');
        const measureBtn = document.getElementById('btn-measure');

        // --- Simulation State ---
        let time = 0;
        let isCollapsed = false;
        
        // Physics / Animation Parameters
        let packetX = 0;           // Current center of the wave
        let collapsedX = 0;        // Where the particle was found
        const velocity = 3;        // Speed of wave movement
        
        // We animate 'currentSigma' to show the shrinking effect
        let targetSigma = 50;      // The width we want (Large for wave, Small for particle)
        let currentSigma = 50;     // The width we are currently drawing
        
        // Constants
        const k = 12;              // Wavenumber (ripples)
        const omega = 0.3;         // Frequency
        const heightScale = 120;
        const centerY = canvas.height / 2;

        function draw() {
            // 1. Clear Screen with fade effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Physics Logic
            if (!isCollapsed) {
                // Move the wave forward
                packetX = (packetX + velocity) % (canvas.width + 200);
                // Keep sigma wide
                targetSigma = 50;
            } else {
                // If collapsed, stop moving packetX
                // Use the collapsed position
                packetX = collapsedX; 
                // Shrink sigma to a sharp point
                targetSigma = 5; 
            }

            // Smoothly animate the width (sigma) changing
            // This creates the visual "sucking in" effect
            currentSigma += (targetSigma - currentSigma) * 0.1;

            // 3. Drawing Loop
            ctx.beginPath();
            ctx.lineWidth = 3;
            
            // Choose color based on state
            // Cyan for Wave, Yellow for Particle
            if (isCollapsed && Math.abs(currentSigma - targetSigma) < 1) {
                ctx.strokeStyle = '#ffcc00'; // Particle Color
                ctx.shadowColor = '#ffcc00';
            } else {
                ctx.strokeStyle = '#00ffff'; // Wave Color
                ctx.shadowColor = '#00ffff';
            }
            ctx.shadowBlur = 15;

            // Draw the curve pixel by pixel
            for (let x = 0; x < canvas.width; x++) {
                
                // Adjust x for wrapping effect logic
                // The actual drawing center logic
                let effectiveX = packetX - 100; // Offset to start off-screen
                
                // Gaussian Envelope Formula
                const envelope = Math.exp(-Math.pow(x - effectiveX, 2) / (2 * currentSigma * currentSigma));
                
                // Wave Oscillation
                // If collapsed, we remove oscillation to show a solid "particle"
                let oscillation = 1;
                if (!isCollapsed) {
                    oscillation = Math.cos(k * (x - effectiveX) * 0.03 - omega * time);
                }

                const y = centerY - (envelope * oscillation * heightScale);

                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            ctx.shadowBlur = 0; // Reset shadow for next frame

            // 4. Update Loop
            time++;
            requestAnimationFrame(draw);
        }

        // --- Interaction Logic ---

        function measure() {
            if (isCollapsed) return;

            // 1. Determine where the particle is found
            // In a real simulation, we would use a weighted random distribution based on Psi^2.
            // Here, we approximate by picking a random spot within the current wave packet.
            
            // Generate a random number between -1 and 1 (approx Gaussian distribution)
            let rand = (Math.random() + Math.random() + Math.random()) / 3 * 2 - 1;
            
            // The particle is found at the center +/- some random variance based on width
            let currentCenter = (packetX % (canvas.width + 200)) - 100;
            collapsedX = currentCenter + (rand * currentSigma);

            // 2. Change State
            isCollapsed = true;
            statusText.innerText = "State: Collapsed (Particle Localized at x=" + Math.floor(collapsedX) + ")";
            measureBtn.disabled = true;
            measureBtn.innerText = "Observed";
        }

        function resetSim() {
            isCollapsed = false;
            currentSigma = 5; // Start small and grow back? Or start big? Let's start big.
            currentSigma = 50; 
            targetSigma = 50;
            
            // Reset position to start
            packetX = 0;
            
            statusText.innerText = "State: Superposition (Moving)";
            measureBtn.disabled = false;
            measureBtn.innerText = "Measure Position";
        }

        // Start
        draw();

    </script>
</body>
</html>
