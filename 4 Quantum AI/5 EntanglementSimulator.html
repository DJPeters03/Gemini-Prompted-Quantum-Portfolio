<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qubit Entanglement Simulator</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --q1: #06b6d4; /* Cyan */
            --q2: #f43f5e; /* Rose */
            --text: #e2e8f0;
            --accent: #8b5cf6; /* Violet */
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 { margin-bottom: 5px; text-shadow: 0 0 10px var(--accent); }
        p.subtitle { color: #94a3b8; font-size: 0.9em; margin-bottom: 30px; }

        /* --- Layout --- */
        .simulator-container {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 900px;
        }

        .qubit-box {
            background: var(--card);
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 20px;
            width: 250px;
            text-align: center;
            position: relative;
            transition: border-color 0.3s;
        }

        .qubit-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid #333;
            margin: 0 auto 15px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            background: #000;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }

        .q1-color { color: var(--q1); border-color: var(--q1); }
        .q2-color { color: var(--q2); border-color: var(--q2); }

        .gate-display {
            font-size: 32px;
            font-weight: bold;
            height: 50px;
            margin: 10px 0;
            color: #fff;
            text-shadow: 0 0 5px currentColor;
        }

        /* --- Middle Section (Link) --- */
        .entanglement-link {
            width: 100px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            position: relative;
        }

        .link-active {
            background: var(--accent);
            box-shadow: 0 0 20px var(--accent);
            animation: pulse 0.5s infinite alternate;
        }

        @keyframes pulse { from { opacity: 0.6; } to { opacity: 1; box-shadow: 0 0 30px var(--accent); } }

        /* --- Stats & Probability Bars --- */
        .stats-container {
            margin-top: 15px;
            text-align: left;
            font-size: 12px;
        }

        .bar-row {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .bar-label { width: 20px; font-weight: bold; }
        .bar-track { flex-grow: 1; background: #333; height: 6px; border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s; }

        /* --- Scoreboard --- */
        .scoreboard {
            margin-top: 30px;
            background: #000;
            padding: 15px 30px;
            border-radius: 50px;
            border: 1px solid #333;
            font-size: 20px;
            display: flex;
            gap: 20px;
        }
        .score-val { font-weight: bold; color: #fff; }

        /* --- Controls --- */
        .controls { margin-top: 20px; }
        button {
            background: var(--text);
            color: var(--bg);
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover { background: #fff; box-shadow: 0 0 10px #fff; }

        /* --- Log --- */
        #log {
            width: 100%;
            max-width: 600px;
            height: 100px;
            overflow-y: auto;
            background: #000;
            border: 1px solid #333;
            margin-top: 20px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            color: #777;
        }
        .log-success { color: var(--accent); }
        .log-fail { color: #555; }

    </style>
</head>
<body>

    <h1>Quantum Entanglement Simulator</h1>
    <p class="subtitle">Two Qubits blind-pick gates. Only specific combinations create a Bell State.</p>

    <div class="simulator-container">
        <div class="qubit-box" id="box-q1">
            <div class="qubit-icon q1-color" id="icon-q1">|0⟩</div>
            <div>Qubit 1 Choice</div>
            <div class="gate-display" id="gate-q1">?</div>
            
            <div class="stats-container">
                <div>Learning (Gate Probabilities):</div>
                <div id="bars-q1"></div>
            </div>
        </div>

        <div>
            <div class="entanglement-link" id="link"></div>
            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #777;">CNOT Interaction</div>
        </div>

        <div class="qubit-box" id="box-q2">
            <div class="qubit-icon q2-color" id="icon-q2">|0⟩</div>
            <div>Qubit 2 Choice</div>
            <div class="gate-display" id="gate-q2">?</div>

            <div class="stats-container">
                <div>Learning (Gate Probabilities):</div>
                <div id="bars-q2"></div>
            </div>
        </div>
    </div>

    <div class="scoreboard">
        <div>Score: <span id="score" class="score-val">0</span></div>
        <div>Entanglements: <span id="wins" class="score-val" style="color:var(--accent)">0</span></div>
    </div>

    <div class="controls">
        <button onclick="toggleSimulation()" id="btn-toggle">Start Simulation</button>
        <button onclick="reset()">Reset</button>
    </div>

    <div id="log"></div>

    <script>
        // --- Configuration ---
        const gates = ['I', 'H', 'X', 'Z'];
        // I = Identity (Do nothing)
        // H = Hadamard (Superposition)
        // X = Bit Flip (NOT)
        // Z = Phase Flip
        
        let score = 0;
        let wins = 0;
        let isRunning = false;
        let intervalId = null;
        let speed = 800; // ms per tick

        // --- Qubit AI State ---
        // Weights determine probability of picking a gate. Start equal.
        let q1Weights = { 'I': 10, 'H': 10, 'X': 10, 'Z': 10 };
        let q2Weights = { 'I': 10, 'H': 10, 'X': 10, 'Z': 10 };

        // --- DOM Elements ---
        const ui = {
            gateQ1: document.getElementById('gate-q1'),
            gateQ2: document.getElementById('gate-q2'),
            link: document.getElementById('link'),
            score: document.getElementById('score'),
            wins: document.getElementById('wins'),
            log: document.getElementById('log'),
            barsQ1: document.getElementById('bars-q1'),
            barsQ2: document.getElementById('bars-q2'),
            btn: document.getElementById('btn-toggle'),
            iconQ1: document.getElementById('icon-q1'),
            iconQ2: document.getElementById('icon-q2')
        };

        // --- Core Logic ---

        function pickGate(weights) {
            // Weighted random selection
            const total = Object.values(weights).reduce((a, b) => a + b, 0);
            let random = Math.random() * total;
            
            for (const gate of gates) {
                if (random < weights[gate]) {
                    return gate;
                }
                random -= weights[gate];
            }
            return gates[gates.length - 1];
        }

        function checkEntanglement(g1, g2) {
            // SIMULATION LOGIC:
            // We assume a circuit: |00> -> (G1 x G2) -> CNOT -> Measure
            
            // To create entanglement (Bell State) from |00>:
            // Q1 MUST apply Hadamard (H) to create superposition.
            // Q2 can apply I or X to determine WHICH Bell state, but entanglement exists either way.
            // If Q1 applies I, X, or Z, the CNOT just passes states through (Product State).

            // Simple Rule: If Q1 is 'H', we get entanglement (mostly).
            // We'll treat (H, I) and (H, X) as +1 (Bell States Phi+ and Psi+).
            // (H, Z) creates a phase difference but is still entangled, let's count it.
            
            // Q1 MUST be H.
            if (g1 === 'H') return true; 
            return false;
        }

        function updateWeights(weights, gate, reward) {
            // Simple Reinforcement Learning
            if (reward > 0) {
                weights[gate] += 2; // Strengthen winning path
            } else {
                weights[gate] = Math.max(1, weights[gate] - 1); // Weaken losing path
            }
        }

        function renderBars(container, weights, color) {
            container.innerHTML = '';
            const total = Object.values(weights).reduce((a, b) => a + b, 0);
            
            gates.forEach(gate => {
                const percent = (weights[gate] / total) * 100;
                const row = document.createElement('div');
                row.className = 'bar-row';
                row.innerHTML = `
                    <span class="bar-label">${gate}</span>
                    <div class="bar-track">
                        <div class="bar-fill" style="width:${percent}%; background-color: ${color}"></div>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function step() {
            // 1. Agents Choose Independently
            const c1 = pickGate(q1Weights);
            const c2 = pickGate(q2Weights);

            // 2. Update Visuals
            ui.gateQ1.innerText = c1;
            ui.gateQ2.innerText = c2;

            // 3. Physics Check
            const entangled = checkEntanglement(c1, c2);

            // 4. Reward/Punish
            if (entangled) {
                score += 1;
                wins += 1;
                
                // Visual Success
                ui.link.classList.add('link-active');
                ui.iconQ1.style.boxShadow = "0 0 15px var(--accent)";
                ui.iconQ2.style.boxShadow = "0 0 15px var(--accent)";
                ui.iconQ1.innerText = "|Φ⁺⟩";
                ui.iconQ2.innerText = "|Φ⁺⟩";
                log(`[SUCCESS] Q1:${c1} + Q2:${c2} -> Entangled! (+1)`);

                // Learn
                updateWeights(q1Weights, c1, 1);
                updateWeights(q2Weights, c2, 1);
            } else {
                score -= 1;
                
                // Visual Fail
                ui.link.classList.remove('link-active');
                ui.iconQ1.style.boxShadow = "none";
                ui.iconQ2.style.boxShadow = "none";
                ui.iconQ1.innerText = "|0⟩"; // Simplified state representation
                ui.iconQ2.innerText = "|0⟩";
                log(`[FAIL] Q1:${c1} + Q2:${c2} -> Product State (-1)`, 'fail');

                // Learn
                updateWeights(q1Weights, c1, -1);
                updateWeights(q2Weights, c2, -1);
            }

            // 5. Update Stats
            ui.score.innerText = score;
            ui.wins.innerText = wins;
            renderBars(ui.barsQ1, q1Weights, 'var(--q1)');
            renderBars(ui.barsQ2, q2Weights, 'var(--q2)');
        }

        function log(msg, type='success') {
            const div = document.createElement('div');
            div.innerText = msg;
            if(type === 'fail') div.className = 'log-fail';
            else div.className = 'log-success';
            ui.log.prepend(div);
        }

        function toggleSimulation() {
            if (isRunning) {
                clearInterval(intervalId);
                isRunning = false;
                ui.btn.innerText = "Resume Simulation";
            } else {
                intervalId = setInterval(step, speed);
                isRunning = true;
                ui.btn.innerText = "Pause Simulation";
            }
        }

        function reset() {
            clearInterval(intervalId);
            isRunning = false;
            ui.btn.innerText = "Start Simulation";
            score = 0;
            wins = 0;
            
            // Reset Brains
            q1Weights = { 'I': 10, 'H': 10, 'X': 10, 'Z': 10 };
            q2Weights = { 'I': 10, 'H': 10, 'X': 10, 'Z': 10 };
            
            // Reset UI
            ui.score.innerText = 0;
            ui.wins.innerText = 0;
            ui.gateQ1.innerText = "?";
            ui.gateQ2.innerText = "?";
            ui.log.innerHTML = "";
            ui.link.classList.remove('link-active');
            renderBars(ui.barsQ1, q1Weights, 'var(--q1)');
            renderBars(ui.barsQ2, q2Weights, 'var(--q2)');
        }

        // Init
        renderBars(ui.barsQ1, q1Weights, 'var(--q1)');
        renderBars(ui.barsQ2, q2Weights, 'var(--q2)');

    </script>
</body>
</html>
